"use strict";const t=require("../../common/vendor.js"),e=require("../../request.api/index.js"),i=require("../../utils/umob.js"),a={namespaced:!0,state:()=>({navHeight:60,mainGap:[32,0,8,0],mainWidth:{width:.62,minWidth:332},mediaCriticalValue:544,homeListData:[],homeTotalListData:[],activeNavIndex:"",activeIncomeTab:"day",activeOrderTab:"order",activeDataTab:"dayKline",showLoginDrawerStatus:!1,closeSettingShowStatus:!1,switchUserFlag:!1,goods:{type:"",lot:1,pricePrev:0,priceNext:0},USER_INFO:{}}),getters:{mainStyle:t=>({marginTop:`${t.mainGap[0]}px`,width:100*t.mainWidth.width+"%",minWidth:`${t.mainWidth.minWidth}px`,height:`calc(100% - ${t.mainGap[0]+t.mainGap[2]}px)`}),overMediaCritical:t=>document.body.clientWidth<t.mediaCriticalValue,isLogin:t=>!!t.USER_INFO.userId,isWhiteUser:t=>1,isAdministrator:t=>0},mutations:{setActiveIncomeTab(t,e){t.activeIncomeTab=e},setActiveOrderTab(t,e){t.activeOrderTab=e},setActiveDataTab(t,e){t.activeDataTab=e},setGoodsType(t,e){t.goods.type=e},setGoodsLot(t,e){t.goods.lot=e},setGoodsPricePrev(t,e){t.goods.pricePrev=e},setGoodsPriceNext(t,e){t.goods.priceNext=e},setHomeListData(t,e){t.homeListData=e},setHomeTotalListData(t,e){t.homeTotalListData=e},updateActiveNavIndex(t,e){t.activeNavIndex=e},setLoginDrawerStatus(e,i){i&&t.index.navigateTo({url:"/pages/login/index"})},setCloseSettingShowStatus(t,e){t.closeSettingShowStatus=e},setInDayFirstLists(t,e){t.USER_INFO.inDayFirstLists=e},SET_USER_INFO(t,e){t.USER_INFO=e}},actions:{async INIT_USER({commit:t,dispatch:a}){const o=i.getCookie("future-uid");if(o){t("SET_USER_INFO",{userId:o});const i=await e.fetchUserInfo(),{data:s={}}=i,{uid:n,avatar:r,account:d,inDayFirstLists:c}=s;n&&(t("SET_USER_INFO",{userId:n,avatar:r,account:d,inDayFirstLists:c.split(",")}),a("updateLocalAvatar",{uid:n,avatar:r}))}},logoutAction({commit:t,dispatch:e}){e("removeLoginStorage"),t("SET_USER_INFO",{}),i.delCookie("future-uid"),i.delCookie("future-token")},saveLoginStatus({},e){const{uid:a,avatar:o,cookies:s}=e;let n=t.index.getStorageSync("future-login-list");t.index.setStorageSync("future-uid",a),t.index.setStorageSync("future-token",s.join(";")),n=n?JSON.parse(n):[],n=n.filter((t=>t.uid!==a)),n.unshift({uid:a,avatar:o,token:i.getCookie("future-token")}),t.index.setStorageSync("future-login-list",JSON.stringify(n))},updateLocalAvatar({},e){const{uid:i,avatar:a}=e;let o=t.index.getStorageSync("future-login-list");o=o?JSON.parse(o):[];for(let s=0;s<o.length;s++)if(o[s].uid===i&&o[s].avatar!==a){o[s].avatar=a,t.index.setStorageSync("future-login-list",JSON.stringify(o));break}},removeLoginStorage({state:e}){let i=t.index.getStorageSync("future-login-list");i=i?JSON.parse(i):[],i=i.filter((t=>t.uid!==e.USER_INFO.userId)),t.index.setStorageSync("future-login-list",JSON.stringify(i))},async requestHomeList({commit:i}){let a=await e.fetchListData();if(a instanceof Array&&a.length){a.sort(((t,e)=>e.id-t.id)),a.forEach(((t,e)=>{if(t.index=e,t.htmlContent.indexOf("qzone/em")>-1){const e=t.htmlContent.split('<img src="');t.htmlContent=e.join('<img src="//qzonestyle.gtimg.cn')}t.htmlContent.indexOf("&nbsp;<br  />")>-1&&(t.htmlContent=t.htmlContent.replace("&nbsp;<br  />","<br  />")),t.htmlContent.indexOf("<br  />&nbsp;")>-1&&(t.htmlContent=t.htmlContent.replace("<br  />&nbsp;","<br  />"))})),i("setHomeTotalListData",JSON.parse(JSON.stringify(a))),i("setHomeListData",a);let e={};return e[window.version]=a,t.index.setStorageSync("message-list",JSON.stringify(e)),!0}return!1}}};exports.app=a;
