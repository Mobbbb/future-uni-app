"use strict";const e=require("../../common/vendor.js"),t=require("../../request.api/index.js"),a=require("./option.js"),n=require("../../utils/umob.js");if(!Array){(e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-picker")+e.resolveComponent("uni-number-box")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-table")+e.resolveComponent("l-echart"))()}Math||((()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker.js")+(()=>"../../uni_modules/uni-number-box/components/uni-number-box/uni-number-box.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../uni_modules/uni-table/components/uni-table/uni-table.js")+(()=>"../../uni_modules/lime-echart/components/l-echart/l-echart.js"))();const r={__name:"index",setup(r){const o=require("../../uni_modules/lime-echart/static/echarts.min"),u=e.ref(null),i=new Date,s=new e.useStore,l=e.ref();e.ref();const d=e.ref([]),m=e.reactive({date:i,name:"",buyOrSale:0,openOrClose:0,hands:0,price:0}),c=e.reactive({date:{rules:[{required:!0,errorMessage:"请选择日期",trigger:"change"}]},name:{rules:[{required:!0,message:"请选择合约",trigger:"change"}]},hands:{rules:[{required:!0,message:"请输入手数",trigger:"change"},{validateFunction:function(e,t,a,n){return t<=0&&n("请输入手数"),!0}}]},price:{rules:[{required:!0,message:"请输入成交价",trigger:"change"},{validateFunction:function(e,t,a,n){return t<=0&&n("请输入成交价"),!0}}]}}),p=e.computed((()=>s.getters["order/futuresList"])),h=e.computed((()=>s.getters["app/isLogin"]));e.computed((()=>s.getters["app/overMediaCritical"]));const f=e.computed((()=>s.state.order.openingOrderList)),v=e.computed((()=>s.state.order.openingOrderGroup)),b=e.computed((()=>{const e=[],t=[];let a=Number(n.dateFormat(i,"yy")),r=Number(n.dateFormat(i,"MM"));for(let n=0;n<6;n++)r++,r>12&&(a++,r=1),r<10?t.unshift(`${a}0${r}`):t.unshift(`${a}${r}`);return p.value.forEach((a=>{e.push([]),t.forEach((t=>{e[e.length-1].unshift(`${a.name}${t}`)}))})),e})),g=e.computed((()=>{const e=[],t=[];let a=Number(n.dateFormat(i,"yy")),r=Number(n.dateFormat(i,"MM"));for(let n=0;n<6;n++)r++,r>12&&(a++,r=1),r<10?t.unshift(`${a}0${r}`):t.unshift(`${a}${r}`);return p.value.forEach((a=>{const n=[];t.forEach((e=>{n.push({text:e,value:`${a.name}${e}`})})),e.push({text:a.name,value:a.name,children:n})})),e}));e.computed((()=>{const e={};return p.value.forEach((t=>{e[t.name.toLowerCase()]=t.name})),e}));const y=e.computed((()=>{const e=f.value.filter((e=>1===e.buyOrSale&&m.name===e.name)),t=f.value.filter((e=>0===e.buyOrSale&&m.name===e.name));return{buyListNum:e.length,saleListNum:t.length}})),w=async(a,r)=>{if(h.value){if(!(await l.value.validate().catch((e=>{}))))return;m.buyOrSale=a,m.openOrClose=r,m.date=n.dateFormat(m.date,"yyyy-MM-dd hh:mm:ss");const o=await t.fetchInsertOrder(m)||{},{success:u}=o;u&&(e.index.showToast({title:"操作成功",duration:2e3,icon:"success"}),S(),m.hands=0,m.price=0)}else o=!0,s.commit("app/setLoginDrawerStatus",o);var o},x=t=>{const{detail:a=[]}=t;m.name=a.value.map((e=>e.value)).join(""),e.index.setStorageSync("default-order-name",m.name)},O=async e=>{const t={x:[],y:[]};v.value[`${e.name}${e.buyOrSale}`].forEach((e=>{for(let a=0;a<e.hands;a++)t.y.push(e.price),t.x.push(n.dateFormat(e.date,"MM.dd"))}));(await u.value.init(o)).setOption(a.getOrderLineOption(t))},S=async()=>{await s.dispatch("order/getOpeningOrderData")},j=async()=>{h.value&&(await(async()=>{const e=await t.fetchRecentlyFeature();d.value=e.data||[],d.value=d.value.slice(0,6)})(),await S(),f.value[0]&&O(f.value[0]))};return e.watch(h,(async e=>{e?j():((e=>{s.commit("order/setOpeningOrderList",e)})([]),d.value=[])})),e.onMounted((async()=>{await j();const t=e.index.getStorageSync("default-order-name");m.name=t||(b.value[0]&&b.value[0][0]||"")})),(t,a)=>e.e({a:e.o((e=>m.date=e)),b:e.p({type:"datetime",placeholder:"请选择日期",modelValue:m.date}),c:e.p({required:!0,label:"交易日期",name:"date"}),d:e.o(x),e:e.o((e=>m.name=e)),f:e.p({localdata:g.value,"popup-title":"请选择合约",modelValue:m.name}),g:e.p({required:!0,label:"合约",name:"name"}),h:e.o((e=>m.price=e)),i:e.p({placeholder:"请输入成交价",modelValue:m.price}),j:e.p({required:!0,label:"成交价",name:"price"}),k:e.o((e=>m.hands=e)),l:e.p({placeholder:"请输入手数",modelValue:m.hands}),m:e.p({required:!0,label:"手数",name:"hands"}),n:e.sr(l,"3fed7351-0",{k:"ruleFormRef"}),o:e.p({modelValue:m,rules:c,"label-width":"95px","label-position":"left"}),p:e.o((e=>w(1,1))),q:e.o((e=>w(0,1))),r:!y.value.buyListNum,s:e.o((e=>w(0,0))),t:!y.value.saleListNum,v:e.o((e=>w(1,0))),w:d.value.length},d.value.length?{x:e.f(d.value,((t,a,n)=>({a:e.t(t),b:e.o((a=>{return n=t,m.name=n,void e.index.setStorageSync("default-order-name",m.name);var n}),t),c:t})))}:{},{y:e.p({prop:"name",label:"合约",width:"70",fixed:"left"}),z:e.p({prop:"buyOrSale",width:"60",label:"多/空"}),A:e.p({prop:"price",minWidth:"90",label:"开仓均价"}),B:e.p({prop:"hands",label:"手数"}),C:e.p({prop:"commission",width:"120",label:"开仓总手续费"}),D:e.f(f.value,((t,a,n)=>({a:e.t(t.name),b:"3fed7351-17-"+n+",3fed7351-16-"+n,c:e.t(t.buyOrSale?"多":"空"),d:e.s(t.buyOrSale?{color:"#eb4436"}:{color:"#0e9d58"}),e:"3fed7351-18-"+n+",3fed7351-16-"+n,f:e.t(t.price),g:"3fed7351-19-"+n+",3fed7351-16-"+n,h:e.t(t.hands),i:"3fed7351-20-"+n+",3fed7351-16-"+n,j:e.t(t.commission),k:"3fed7351-21-"+n+",3fed7351-16-"+n,l:a,m:e.o((a=>{return n=t,m.name=n.name,m.hands=n.hands,e.index.setStorageSync("default-order-name",m.name),void O(n);var n}),a),n:"3fed7351-16-"+n+",3fed7351-9"}))),E:e.p({border:!0}),F:h.value},h.value?{G:e.sr(u,"3fed7351-22",{k:"chartRef"})}:{})}},o=e._export_sfc(r,[["__scopeId","data-v-3fed7351"]]);wx.createPage(o);
